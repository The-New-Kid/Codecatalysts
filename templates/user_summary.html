{% extends "user_layout.html" %}
{% block title %}User Summary{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto my-10 p-6 bg-white shadow-xl rounded-3xl border border-gray-200">
  <h1 class="text-3xl font-extrabold text-indigo-700 mb-6 text-center tracking-tight">
    ðŸ›• Parking & Darshan Analytics Dashboard
  </h1>

  <!-- Stats Row -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10">
    <div class="bg-indigo-100 text-indigo-800 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <h3 class="text-lg font-semibold mb-2">Total Spots</h3>
      <p class="text-3xl font-bold">{{ total }}</p>
    </div>
    <div class="bg-pink-100 text-pink-800 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <h3 class="text-lg font-semibold mb-2">Occupied</h3>
      <p class="text-3xl font-bold">{{ occupied }}</p>
    </div>
    <div class="bg-green-100 text-green-800 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <h3 class="text-lg font-semibold mb-2">Vacant</h3>
      <p class="text-3xl font-bold">{{ vacant }}</p>
    </div>
  </div>

  <!-- Real Summary Chart -->
  <div class="bg-gradient-to-br from-indigo-50 to-purple-100 rounded-2xl p-6 shadow-md mb-10">
    <h2 class="text-2xl font-semibold mb-4 text-gray-700 text-center">ðŸ“Š Parking Usage Summary</h2>
    <div class="flex justify-center">
      <img src="{{ url_for('static', filename='user_parking_summary.png') }}" 
           alt="Usage Chart" 
           class="rounded-xl border border-gray-300 shadow-lg w-4/5 transition hover:scale-105 duration-300">
    </div>
  </div>

  <!-- Additional Graphs -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
    <!-- Fake Heatmap -->
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-200">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700 text-center">ðŸ”¥ Visitor Heatmap</h3>
      <div id="heatmap" class="grid grid-cols-7 gap-1 w-full max-w-md mx-auto"></div>
      <p class="text-gray-500 text-center mt-3 text-sm">Darker = More Visitors</p>
    </div>

    <!-- Line Chart -->
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-200">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700 text-center">ðŸ“ˆ Daily Parking Trends</h3>
      <canvas id="lineChart" class="w-full h-64"></canvas>
    </div>

    <!-- Pie Chart -->
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-200">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700 text-center">ðŸ§¾ Darshan Slot Distribution</h3>
      <canvas id="pieChart" class="w-full h-64"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-200">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700 text-center">ðŸš— Vehicle Type Analysis</h3>
      <canvas id="barChart" class="w-full h-64"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // --- Fake HEATMAP (works without plugins) ---
  const heatmapContainer = document.getElementById('heatmap');
  for (let i = 0; i < 35; i++) { // 5x7 grid
    const intensity = Math.random(); // Random crowd value
    const cell = document.createElement('div');
    cell.style.width = '100%';
    cell.style.aspectRatio = '1';
    cell.style.borderRadius = '4px';
    cell.style.backgroundColor = `rgba(99,102,241,${0.2 + intensity * 0.8})`;
    heatmapContainer.appendChild(cell);
  }

  // --- Line Chart ---
  new Chart(document.getElementById('lineChart'), {
    type: 'line',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
      datasets: [{
        label: 'Bookings',
        data: [12, 19, 15, 22, 25, 30, 28],
        borderColor: '#6366f1',
        backgroundColor: 'rgba(99,102,241,0.2)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {responsive: true, plugins: {legend: {display: false}}}
  });

  // --- Pie Chart ---
  new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
      labels: ['Morning', 'Afternoon', 'Evening'],
      datasets: [{
        data: [40, 30, 30],
        backgroundColor: ['#818cf8', '#f472b6', '#34d399']
      }]
    }
  });

  // --- Bar Chart ---
  new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
      labels: ['Car', 'Bike', 'Bus', 'Auto'],
      datasets: [{
        label: 'Vehicles',
        data: [30, 45, 10, 15],
        backgroundColor: ['#6366f1', '#34d399', '#fbbf24', '#f472b6']
      }]
    },
    options: {
      scales: {y: {beginAtZero: true}},
      plugins: {legend: {display: false}}
    }
  });
</script>
{% endblock %}
